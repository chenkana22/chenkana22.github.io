<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>記憶卡牌遊戲</title>

<style>
:root {
    --card-size: 100px;
}

/* ===== 基本 ===== */
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #eee;
    display: flex;
    flex-direction: column;
    align-items: center;
}

h1 {
    margin: 16px 0;
}

/* ===== 主容器 ===== */
.game-container {
    width: 100%;
    max-width: 1100px;
    padding: 10px;
}

/* ===== 棋盤 ===== */
.board {
    display: grid;
    gap: 10px;
    justify-content: center;
    margin: 0 auto;
}

/* ===== 卡牌 ===== */
.card {
    width: var(--card-size);
    height: var(--card-size);
    perspective: 1000px;
}

.card-inner {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s;
}

.card-back,
.card-front {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 12px;
    backface-visibility: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* ✅ 解方一：圖片完整顯示、不裁切 */
.card-back {
    background-image: url("imagesback.png");
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    background-color: white;
}

.card-front {
    background: #ff9800;
    color: white;
    font-size: 28px;
    transform: rotateY(180deg);
}

.flipped .card-inner,
.matched .card-inner {
    transform: rotateY(180deg);
}

/* ===== 配對堆疊區（固定卡牌大小） ===== */
.stack-area {
    min-width: var(--card-size);
    min-height: var(--card-size);
    background: #bbb;
    border-radius: 12px;
    padding: 10px;
    margin: 15px auto 0;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* ===== 控制區 ===== */
.controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 15px;
}

.restart-btn {
    padding: 10px 18px;
    background: #d32f2f;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

.score-board {
    padding: 10px 18px;
    background: #1976d2;
    color: white;
    border-radius: 8px;
}

/* ===== 關卡選擇 ===== */
.levels {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 15px;
    flex-wrap: wrap;
}

.levels button {
    padding: 8px 14px;
    border-radius: 8px;
    border: none;
    background: #81d4fa;
    cursor: pointer;
}

.levels button.active {
    background: #0288d1;
    color: white;
}

/* ===== 勝利文字 ===== */
#winText {
    position: fixed;
    top: 45%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 48px;
    font-weight: bold;
    color: #6fb9dd;
    text-shadow: 0 0 8px white, 0 0 20px #6fb9dd;
    display: none;
    z-index: 999;
}

/* ===== 平板 ===== */
@media (max-width: 1024px) {
    :root {
        --card-size: 80px;
    }
}

/* ===== 手機 ===== */
@media (max-width: 600px) {
    :root {
        --card-size: 60px;
    }

    .controls {
        flex-direction: column;
        gap: 10px;
    }

    #winText {
        font-size: 36px;
    }
}
</style>
</head>

<body>

<h1>記憶卡牌遊戲</h1>
<div id="winText">挑戰成功！</div>

<div class="game-container">

    <div id="board" class="board"></div>

    <div id="stackArea" class="stack-area">
        <div>配對堆疊</div>
    </div>

    <div class="controls">
        <button id="restartBtn" class="restart-btn">重新開始</button>
        <div id="scoreBoard" class="score-board">得分：0</div>
    </div>

    <div class="levels">
        <button onclick="setLevel(2,5,this)">簡單 2×5</button>
        <button class="active" onclick="setLevel(5,6,this)">中等 5×6</button>
        <button onclick="setLevel(5,8,this)">困難 5×8</button>
    </div>

</div>

<script>
const board = document.getElementById("board");
const scoreBoard = document.getElementById("scoreBoard");
const stackArea = document.getElementById("stackArea");
const winText = document.getElementById("winText");

let rows = 5, cols = 6;
let totalPairs = 15;
let firstCard = null, secondCard = null;
let lockBoard = false, score = 0;

function setLevel(r, c, btn) {
    rows = r;
    cols = c;
    totalPairs = (r * c) / 2;

    document.querySelectorAll(".levels button")
        .forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    createBoard();
}

function generateCards() {
    const arr = [];
    for (let i = 1; i <= totalPairs; i++) arr.push(i, i);
    return arr.sort(() => Math.random() - 0.5);
}

function createBoard() {
    board.innerHTML = "";
    stackArea.innerHTML = "<div>配對堆疊</div>";
    score = 0;
    scoreBoard.textContent = "得分：0";
    winText.style.display = "none";

    board.style.gridTemplateColumns = `repeat(${cols}, var(--card-size))`;

    generateCards().forEach(v => {
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.value = v;
        card.innerHTML = `
            <div class="card-inner">
                <div class="card-back"></div>
                <div class="card-front">${v}</div>
            </div>`;
        card.onclick = () => flip(card);
        board.appendChild(card);
    });
}

function flip(card) {
    if (lockBoard || card === firstCard || card.classList.contains("matched")) return;
    card.classList.add("flipped");

    if (!firstCard) {
        firstCard = card;
        return;
    }

    secondCard = card;
    lockBoard = true;
    setTimeout(check, 600);
}

function check() {
    if (firstCard.dataset.value === secondCard.dataset.value) {
        firstCard.classList.add("matched");
        secondCard.classList.add("matched");

        moveToStack(firstCard);
        moveToStack(secondCard);

        score++;
        scoreBoard.textContent = "得分：" + score;

        if (score === totalPairs) winText.style.display = "block";
    } else {
        firstCard.classList.remove("flipped");
        secondCard.classList.remove("flipped");
    }

    firstCard = secondCard = null;
    lockBoard = false;
}

/* ✅ 把配對成功的卡牌真的疊進去 */
function moveToStack(card) {
    const clone = card.cloneNode(true);
    clone.style.marginTop = "-60px";
    clone.style.pointerEvents = "none";
    stackArea.appendChild(clone);
}

document.getElementById("restartBtn").onclick = createBoard;
createBoard();
</script>

</body>
</html>
